## Документация по метрикам

### Общие сведения
Эти метрики собираются из нашего сервиса календаря и предоставляют информацию о состоянии и производительности API.

### Метрики API

#### 1. Количество запросов к API

- **Имя метрики**: `api_requests_total`
- **Описание**: Общее количество запросов к API.
- **Тип**: Counter
- **Метки**:
  - `method`: HTTP метод (например, GET, POST).
  - `endpoint`: URL эндпоинта.
  - `status`: HTTP статус ответа (например, 200, 404).
- **Пример запроса в Prometheus**:
  ```prometheus
  sum(rate(api_requests_total[1m])) by (method, endpoint, status)
  ```

#### Пояснение:
- **rate(api_requests_total[1m])**: Эта функция вычисляет скорость изменения метрики `api_requests_total` за последнюю минуту (1m). Это означает, что она вычисляет количество запросов в секунду за последний минутный интервал.
- **sum()**: Суммирует значения скорости изменения для всех меток.
- **by (method, endpoint, status)**: Группирует результаты по HTTP методу (`method`), URL эндпоинту (`endpoint`) и статусу ответа (`status`).

#### Пример вывода:
Предположим, что ваш API получает различные запросы. Результат запроса может выглядеть следующим образом:
```
method | endpoint | status | value
-------|----------|--------|-------
GET    | /events  | 200    | 0.5
POST   | /event   | 201    | 0.1
GET    | /event/1 | 404    | 0.05
```
Этот результат означает:
- Количество запросов с методом `GET` на эндпоинт `/events` со статусом `200` составляет 0.5 запросов в секунду.
- Количество запросов с методом `POST` на эндпоинт `/event` со статусом `201` составляет 0.1 запросов в секунду.
- Количество запросов с методом `GET` на эндпоинт `/event/1` со статусом `404` составляет 0.05 запросов в секунду.

#### 2. Время обработки запросов

- **Имя метрики**: `api_response_duration_seconds`
- **Описание**: Время обработки запросов в секундах.
- **Тип**: Histogram
- **Метки**:
  - `method`: HTTP метод (например, GET, POST).
  - `endpoint`: URL эндпоинта.
- **Пример запроса в Prometheus**:
  ```prometheus
  histogram_quantile(0.95, sum(rate(api_response_duration_seconds_bucket[5m])) by (le, method, endpoint))
  ```
#### Пояснение:
- **histogram_quantile(0.95, ...)**: Эта функция вычисляет 95-й процентиль времени обработки запросов. Это означает, что 95% запросов выполняются быстрее указанного времени.
- **rate(api_response_duration_seconds_bucket[5m])**: Эта функция вычисляет скорость изменения значений гистограммы `api_response_duration_seconds_bucket` за последние 5 минут (5m).
- **sum()**: Суммирует значения скорости изменения для всех меток `le` (less or equal, "меньше или равно"), которые представляют собой интервалы гистограммы.
- **by (le, method, endpoint)**: Группирует результаты по интервалам гистограммы (`le`), HTTP методу (`method`) и URL эндпоинту (`endpoint`).

#### Пример вывода:
Предположим, что ваш API обрабатывает запросы с различным временем выполнения. Результат запроса может выглядеть следующим образом:
```
method | endpoint | value
-------|----------|-------
GET    | /events  | 0.2
POST   | /event   | 0.5
GET    | /event/1 | 1.2
```
Этот результат означает:
- 95% запросов с методом `GET` на эндпоинт `/events` выполняются быстрее 0.2 секунд.
- 95% запросов с методом `POST` на эндпоинт `/event` выполняются быстрее 0.5 секунд.
- 95% запросов с методом `GET` на эндпоинт `/event/1` выполняются быстрее 1.2 секунд.

### Метрики событий

#### 3. Количество созданных событий

- **Имя метрики**: `events_created_total`
- **Описание**: Общее количество созданных событий.
- **Тип**: Counter
- **Пример запроса в Prometheus**:
  ```prometheus
  events_created_total
  ```

#### 4. Количество обновленных событий

- **Имя метрики**: `events_updated_total`
- **Описание**: Общее количество обновленных событий.
- **Тип**: Counter
- **Пример запроса в Prometheus**:
  ```prometheus
  events_updated_total
  ```

#### 5. Количество удаленных событий

- **Имя метрики**: `events_deleted_total`
- **Описание**: Общее количество удаленных событий.
- **Тип**: Counter
- **Пример запроса в Prometheus**:
  ```prometheus
  events_deleted_total
  ```

### Примечания

- **Запросы в Prometheus**: Примеры запросов можно использовать для создания графиков в Grafana или других системах мониторинга.
- **Обновление метрик**: Метрики обновляются в реальном времени при каждом запросе и операции в сервисе.
